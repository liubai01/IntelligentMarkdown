# æ™ºèƒ½ Markdown Lua å˜é‡åŒå‘ç»‘å®šæ¡†æ¶

## é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ª VS Code æ’ä»¶ï¼Œæ—¨åœ¨ä¸ºæ¸¸æˆç­–åˆ’æä¾›ä¸€ä¸ªåŸºäº Markdown çš„å¯è§†åŒ–é…ç½®ç¼–è¾‘å™¨ã€‚é€šè¿‡åœ¨ Markdown æ–‡æ¡£ä¸­å®šä¹‰ç‰¹æ®Šçš„é“¾æ¥è¯­æ³•ï¼Œç­–åˆ’å¯ä»¥ç›´æ¥åœ¨æ–‡æ¡£ä¸­ä¿®æ”¹ Lua é…ç½®æ–‡ä»¶ä¸­çš„å˜é‡å€¼ï¼Œå®ç°**æ‰€è§å³æ‰€å¾—**çš„é…ç½®ä½“éªŒã€‚

### æ ¸å¿ƒä»·å€¼

- **é™ä½é—¨æ§›**ï¼šç­–åˆ’æ— éœ€ç†è§£ Lua è¯­æ³•ï¼Œåªéœ€åœ¨ç†Ÿæ‚‰çš„ Markdown æ–‡æ¡£ä¸­æ“ä½œ
- **ä¿æŒçµæ´»æ€§**ï¼šç¨‹åºå‘˜ä»å¯ç›´æ¥ç¼–è¾‘ Lua ä»£ç ï¼Œä¿æŒä»£ç ç»“æ„ä¸å˜
- **åŒå‘åŒæ­¥**ï¼šMarkdown å’Œ Lua æ–‡ä»¶å®æ—¶åŒå‘åŒæ­¥ï¼Œä»»ä¸€æ–¹ä¿®æ”¹éƒ½èƒ½åæ˜ åˆ°å¦ä¸€æ–¹

### å½“å‰å®ç°çŠ¶æ€

| é˜¶æ®µ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| ç¬¬ä¸€é˜¶æ®µï¼šMVP åŸå‹ | âœ… å·²å®Œæˆ | Lua è§£æã€æ–‡æ¡£é“¾æ¥ã€æ‚¬åœæç¤º |
| ç¬¬äºŒé˜¶æ®µï¼šWebview ç¼–è¾‘å™¨ | âœ… å·²å®Œæˆ | å¯è§†åŒ–é¢„è§ˆã€é…ç½®æ§ä»¶ |
| ç¬¬ä¸‰é˜¶æ®µï¼šåŒå‘ç»‘å®š | âœ… å·²å®Œæˆ | ä¿®æ”¹æ§ä»¶è‡ªåŠ¨å†™å…¥ Lua |
| ç¬¬å››é˜¶æ®µï¼šé«˜çº§åŠŸèƒ½ | ğŸ”„ è¿›è¡Œä¸­ | æ™ºèƒ½è¡¥å…¨ã€ç±»å‹æ ¡éªŒç­‰ |

---

## ä¸€ã€æ€»ä½“æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    è¡¨ç°å±‚ (Presentation Layer)                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              Smart Markdown Editor (Webview)               â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚ Input   â”‚  â”‚ Slider  â”‚  â”‚ Select  â”‚  â”‚ Boolean     â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ è¾“å…¥æ¡†   â”‚  â”‚ æ»‘åŠ¨æ¡   â”‚  â”‚ ä¸‹æ‹‰æ¡†   â”‚  â”‚ å¼€å…³æŒ‰é’®    â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â–²
                              â”‚ postMessage
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  é€»è¾‘å±‚ (Extension Host Layer)                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   Linker    â”‚  â”‚   Watcher   â”‚  â”‚  SmartMarkdownEditor    â”‚  â”‚
â”‚  â”‚  é“¾æ¥è§£æå™¨  â”‚  â”‚  æ–‡ä»¶ç›‘å¬å™¨  â”‚  â”‚     é¢„è§ˆç¼–è¾‘å™¨æä¾›è€…      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â–²
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     æ•°æ®å±‚ (AST Layer)                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚     Lua Parser      â”‚  â”‚       Lua Patcher               â”‚   â”‚
â”‚  â”‚   (luaparse AST)    â”‚  â”‚    (ç²¾å‡†å€¼æ›¿æ¢ï¼Œä¿ç•™æ ¼å¼)         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## äºŒã€é¡¹ç›®ç›®å½•ç»“æ„

```
intelligent-markdown/
â”œâ”€â”€ package.json                 # æ’ä»¶é…ç½®æ–‡ä»¶
â”œâ”€â”€ tsconfig.json               # TypeScript é…ç½®
â”œâ”€â”€ webpack.config.js           # Webpack æ‰“åŒ…é…ç½®
â”œâ”€â”€ vitest.config.ts            # æµ‹è¯•é…ç½®
â”‚
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ extension.ts            # æ’ä»¶å…¥å£
â”‚   â”‚
â”‚   â”œâ”€â”€ core/                   # æ ¸å¿ƒæ¨¡å—
â”‚   â”‚   â”œâ”€â”€ index.ts
â”‚   â”‚   â”œâ”€â”€ parser/
â”‚   â”‚   â”‚   â”œâ”€â”€ luaParser.ts         # Lua AST è§£æå™¨
â”‚   â”‚   â”‚   â””â”€â”€ configBlockParser.ts # é…ç½®å—è§£æå™¨
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ linker/
â”‚   â”‚   â”‚   â”œâ”€â”€ luaLinker.ts         # Lua æ–‡ä»¶é“¾æ¥å™¨
â”‚   â”‚   â”‚   â””â”€â”€ pathResolver.ts      # è·¯å¾„è§£æå™¨
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ patcher/
â”‚   â”‚       â””â”€â”€ luaPatcher.ts        # Lua æ–‡ä»¶ä¿®è¡¥å™¨
â”‚   â”‚
â”‚   â”œâ”€â”€ editor/                 # ç¼–è¾‘å™¨æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ index.ts
â”‚   â”‚   â””â”€â”€ smartMarkdownEditor.ts   # Webview é¢„è§ˆç¼–è¾‘å™¨
â”‚   â”‚
â”‚   â”œâ”€â”€ providers/              # VS Code æä¾›è€…
â”‚   â”‚   â”œâ”€â”€ index.ts
â”‚   â”‚   â”œâ”€â”€ documentLinkProvider.ts  # æ–‡æ¡£é“¾æ¥
â”‚   â”‚   â”œâ”€â”€ hoverProvider.ts         # æ‚¬åœæç¤º
â”‚   â”‚   â””â”€â”€ decorationProvider.ts    # å†…è”è£…é¥°å™¨
â”‚   â”‚
â”‚   â”œâ”€â”€ commands/               # å‘½ä»¤
â”‚   â”‚   â”œâ”€â”€ index.ts
â”‚   â”‚   â””â”€â”€ showVariableValue.ts     # æ˜¾ç¤ºå˜é‡å€¼å‘½ä»¤
â”‚   â”‚
â”‚   â””â”€â”€ types/                  # ç±»å‹å®šä¹‰
â”‚       â”œâ”€â”€ index.ts
â”‚       â”œâ”€â”€ configBlock.ts           # é…ç½®å—ç±»å‹
â”‚       â”œâ”€â”€ luaNode.ts               # Lua AST èŠ‚ç‚¹ç±»å‹
â”‚       â””â”€â”€ luaparse.d.ts            # luaparse ç±»å‹å£°æ˜
â”‚
â”œâ”€â”€ test/                       # æµ‹è¯•æ–‡ä»¶
â”‚   â”œâ”€â”€ unit/
â”‚   â”‚   â”œâ”€â”€ luaParser.test.ts
â”‚   â”‚   â”œâ”€â”€ luaPatcher.test.ts
â”‚   â”‚   â””â”€â”€ configBlockParser.test.ts
â”‚   â”‚
â”‚   â””â”€â”€ fixtures/               # æµ‹è¯•ç”¨ä¾‹æ–‡ä»¶
â”‚       â”œâ”€â”€ player_config.lua
â”‚       â””â”€â”€ sample_config.md
â”‚
â”œâ”€â”€ docs/                       # æ–‡æ¡£
â”‚   â””â”€â”€ ARCHITECTURE.md         # æ¶æ„æ–‡æ¡£ï¼ˆæœ¬æ–‡ä»¶ï¼‰
â”‚
â””â”€â”€ .vscode/                    # VS Code é…ç½®
    â”œâ”€â”€ launch.json             # è°ƒè¯•é…ç½®
    â”œâ”€â”€ tasks.json              # ä»»åŠ¡é…ç½®
    â””â”€â”€ settings.json           # ç¼–è¾‘å™¨è®¾ç½®
```

---

## ä¸‰ã€æ ¸å¿ƒæ¨¡å—è®¾è®¡

### 3.1 æ™ºèƒ½ Markdown è¯­æ³•å®šä¹‰ (Protocol)

ä½¿ç”¨ Markdown çš„ Fenced Code Block è¯­æ³•ï¼Œå®šä¹‰ `lua-config` è¯­è¨€æ ‡è®°ï¼š

````markdown
# ç©å®¶åŸºç¡€æ•°å€¼é…ç½®

è¿™é‡Œé…ç½®ç©å®¶å‡ºç”Ÿæ—¶çš„åŸºç¡€å±æ€§ã€‚

### åŸºç¡€ç”Ÿå‘½å€¼
> ç­–åˆ’å¤‡æ³¨ï¼šåˆå§‹ç”Ÿå‘½å€¼ä¸è¦è¶…è¿‡ 10000ï¼Œå¦åˆ™ä¼šå½±å“æ¸¸æˆå¹³è¡¡ã€‚

```lua-config
file: ./scripts/player_config.lua
key: PlayerConfig.BaseStats.HP
type: number
default: 100
min: 1
max: 10000
step: 10
label: ç”Ÿå‘½å€¼ä¸Šé™
```

### ç§»åŠ¨é€Ÿåº¦

```lua-config
file: ./scripts/player_config.lua
key: PlayerConfig.BaseStats.MoveSpeed
type: slider
default: 200
range: [100, 500]
step: 10
label: åŸºç¡€ç§»åŠ¨é€Ÿåº¦
unit: å•ä½/ç§’
```

### è§’è‰²èŒä¸š

```lua-config
file: ./scripts/player_config.lua
key: PlayerConfig.Class
type: select
options:
  - { value: "warrior", label: "æˆ˜å£«" }
  - { value: "mage", label: "æ³•å¸ˆ" }
  - { value: "archer", label: "å¼“ç®­æ‰‹" }
label: é»˜è®¤èŒä¸š
```

### æ˜¯å¦å¯ç”¨æ–°æ‰‹å¼•å¯¼

```lua-config
file: ./scripts/game_settings.lua
key: GameSettings.Tutorial.Enabled
type: boolean
label: æ–°æ‰‹å¼•å¯¼å¼€å…³
```
````

#### é…ç½®å—å±æ€§è¯´æ˜

| å±æ€§ | å¿…å¡« | è¯´æ˜ |
|------|------|------|
| `file` | âœ… | Lua æ–‡ä»¶ç›¸å¯¹è·¯å¾„ï¼ˆç›¸å¯¹äº Markdown æ–‡ä»¶ï¼‰ |
| `key` | âœ… | Lua å˜é‡è·¯å¾„ï¼Œä½¿ç”¨ç‚¹å·åˆ†éš”åµŒå¥—å±‚çº§ |
| `type` | âœ… | æ§ä»¶ç±»å‹ï¼š`number`, `slider`, `string`, `boolean`, `select` |
| `label` | âŒ | æ˜¾ç¤ºæ ‡ç­¾ï¼Œé»˜è®¤ä½¿ç”¨ key çš„æœ€åä¸€æ®µ |
| `default` | âŒ | é»˜è®¤å€¼ |
| `min/max` | âŒ | æ•°å€¼èŒƒå›´é™åˆ¶ |
| `range` | âŒ | slider ä¸“ç”¨ï¼Œç­‰åŒäº [min, max] |
| `step` | âŒ | æ•°å€¼æ­¥è¿› |
| `options` | âŒ | select ä¸“ç”¨ï¼Œé€‰é¡¹åˆ—è¡¨ |
| `unit` | âŒ | å•ä½æ˜¾ç¤º |
| `readonly` | âŒ | æ˜¯å¦åªè¯» |

---

### 3.2 Lua AST è§£æå™¨

#### æ ¸å¿ƒå®ç°

```typescript
// src/core/parser/luaParser.ts

import * as luaparse from 'luaparse';

export class LuaParser {
  private ast: any;
  private code: string;

  constructor(code: string) {
    this.code = code;
    this.ast = luaparse.parse(code, {
      ranges: true,      // å¯ç”¨èŒƒå›´è®°å½•
      locations: true,   // å¯ç”¨ä½ç½®è®°å½•
      comments: true,    // ä¿ç•™æ³¨é‡Šä¿¡æ¯
    });
  }

  /**
   * æ ¹æ®è·¯å¾„æŸ¥æ‰¾ Lua å˜é‡èŠ‚ç‚¹
   * @param keyPath å˜é‡è·¯å¾„ï¼Œå¦‚ "PlayerConfig.BaseStats.HP"
   */
  findValueByPath(keyPath: string): LuaValueResult | null {
    const keys = keyPath.split('.');
    // é€’å½’éå† ASTï¼Œå®šä½ç›®æ ‡èŠ‚ç‚¹
    // è¿”å›å€¼ã€ç±»å‹ã€èŒƒå›´ä¿¡æ¯
  }
}
```

#### æ”¯æŒçš„è·¯å¾„æ ¼å¼

- `Config.BaseStats.HP` - æ™®é€šåµŒå¥—
- `Config.Items[1].Name` - æ•°ç»„ç´¢å¼•ï¼ˆè®¡åˆ’ä¸­ï¼‰
- `Config["special-key"].Value` - å­—ç¬¦ä¸²é”®ï¼ˆè®¡åˆ’ä¸­ï¼‰

---

### 3.3 Lua ä¿®è¡¥å™¨

#### ç²¾å‡†å›å†™ç­–ç•¥

```typescript
// src/core/patcher/luaPatcher.ts

export class LuaPatcher {
  /**
   * æ›´æ–° Lua æ–‡ä»¶ä¸­çš„å€¼
   * æ ¸å¿ƒåŸåˆ™ï¼šåªæ›¿æ¢å€¼çš„éƒ¨åˆ†ï¼Œä¿ç•™æ‰€æœ‰æ³¨é‡Šå’Œæ ¼å¼
   */
  updateValue(
    code: string,
    range: [number, number],
    newValue: any,
    valueType: string
  ): string {
    const formattedValue = this.formatLuaValue(newValue, valueType);
    
    // ç²¾å‡†æ›¿æ¢ï¼šä¿ç•™å‰åçš„æ‰€æœ‰å†…å®¹
    return code.slice(0, range[0]) + formattedValue + code.slice(range[1]);
  }

  /**
   * å°† JavaScript å€¼è½¬æ¢ä¸º Lua æ ¼å¼
   */
  private formatLuaValue(value: any, type: string): string {
    switch (type) {
      case 'number':
        return String(value);
      case 'string':
        return `"${this.escapeLuaString(value)}"`;
      case 'boolean':
        return value ? 'true' : 'false';
      default:
        return String(value);
    }
  }
}
```

---

### 3.4 Webview é¢„è§ˆç¼–è¾‘å™¨

#### åŠŸèƒ½ç‰¹æ€§

| åŠŸèƒ½ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| Markdown æ¸²æŸ“ | âœ… | æ ‡é¢˜ã€æ®µè½ã€åˆ—è¡¨ã€å¼•ç”¨ã€ä»£ç å— |
| é…ç½®å—æ§ä»¶ | âœ… | numberã€sliderã€booleanã€selectã€string |
| å€¼ä¿®æ”¹åŒæ­¥ | âœ… | ä¿®æ”¹æ§ä»¶è‡ªåŠ¨å†™å…¥ Lua æ–‡ä»¶ |
| è·³è½¬æºç  | âœ… | ç‚¹å‡»å®šä½æŒ‰é’®è·³è½¬åˆ° Lua ä»£ç  |
| åˆ·æ–°æŒ‰é’® | âœ… | é‡æ–°è¯»å– Lua æ–‡ä»¶æ›´æ–°æ˜¾ç¤º |
| ä¿®æ”¹é«˜äº® | âœ… | ä¿®æ”¹åæ§ä»¶æ˜¾ç¤ºé«˜äº®åé¦ˆ |

#### æ§ä»¶ç±»å‹

| ç±»å‹ | æ¸²æŸ“æ•ˆæœ | è¯´æ˜ |
|------|---------|------|
| `number` | æ•°å­—è¾“å…¥æ¡† + Â±æŒ‰é’® | æ”¯æŒ min/max/step |
| `slider` | æ»‘åŠ¨æ¡ + æ•°å€¼æ˜¾ç¤º | æ”¯æŒ range/step |
| `boolean` | å¼€å…³æŒ‰é’® | ç‚¹å‡»åˆ‡æ¢ true/false |
| `select` | ä¸‹æ‹‰é€‰æ‹©æ¡† | æ”¯æŒ options é€‰é¡¹åˆ—è¡¨ |
| `string` | æ–‡æœ¬è¾“å…¥æ¡† | é€šç”¨å­—ç¬¦ä¸²è¾“å…¥ |

---

## å››ã€æ•°æ®æµä¸äº¤äº’æµç¨‹

### 4.1 åˆå§‹åŒ–æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç­–åˆ’æ‰“å¼€     â”‚     â”‚  Extension    â”‚     â”‚  Lua Files  â”‚     â”‚   Webview    â”‚
â”‚  config.md   â”‚â”€â”€â”€â”€â–¶â”‚  è§£æ MD æ–‡ä»¶  â”‚â”€â”€â”€â”€â–¶â”‚  è¯»å– & AST â”‚â”€â”€â”€â”€â–¶â”‚  æ¸²æŸ“ UI     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚                      â”‚
                            â”‚   æå–é…ç½®å—å®šä¹‰      â”‚   è·å–å½“å‰å€¼
                            â–¼                      â–¼
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚  linkedBlocks: [                    â”‚
                     â”‚    { file, key, type, value: 100 }  â”‚
                     â”‚    { file, key, type, value: 200 }  â”‚
                     â”‚  ]                                   â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 å€¼ä¿®æ”¹æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç­–åˆ’ä¿®æ”¹    â”‚    postMessage           â”‚   Extension   â”‚
â”‚  HP: 100â†’200 â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶   â”‚   Host        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                                  â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. è¯»å– player_config.lua                                â”‚
â”‚  2. AST è§£æï¼Œå®šä½ PlayerConfig.BaseStats.HP              â”‚
â”‚  3. è·å– range: [156, 159]                               â”‚
â”‚  4. æ›¿æ¢: code.slice(0,156) + "200" + code.slice(159)    â”‚
â”‚  5. å†™å…¥æ–‡ä»¶                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Lua æ–‡ä»¶å·²   â”‚
â”‚ æ›´æ–°å®Œæˆ     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.3 åå‘åŒæ­¥æµç¨‹ï¼ˆLua â†’ Webviewï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç¨‹åºå‘˜ä¿®æ”¹   â”‚     â”‚  FileWatcher     â”‚     â”‚  Webview    â”‚
â”‚  Lua æ–‡ä»¶     â”‚â”€â”€â”€â”€â–¶â”‚  æ£€æµ‹åˆ°å˜åŒ–       â”‚â”€â”€â”€â”€â–¶â”‚  æ›´æ–°æ˜¾ç¤º   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ é‡æ–°è§£æ AST
                              â”‚ æå–æ–°å€¼
                              â”‚ postMessage
                              â–¼
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚ HP: 200â†’300 â”‚
                       â”‚ (è‡ªåŠ¨åˆ·æ–°)   â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## äº”ã€æ’ä»¶é…ç½®é¡¹

| é…ç½®é¡¹ | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|-------|------|--------|------|
| `intelligentMarkdown.autoSave` | boolean | `true` | è‡ªåŠ¨ä¿å­˜å¯¹ Lua æ–‡ä»¶çš„ä¿®æ”¹ |
| `intelligentMarkdown.showInlineValues` | boolean | `true` | åœ¨ç¼–è¾‘å™¨ä¸­æ˜¾ç¤ºå†…è”å€¼ |
| `intelligentMarkdown.autoOpenPreview` | boolean | `false` | æ‰“å¼€ Markdown æ—¶è‡ªåŠ¨æ˜¾ç¤ºé¢„è§ˆ |
| `intelligentMarkdown.autoOpenPreviewPattern` | string | `**/*.config.md` | è‡ªåŠ¨é¢„è§ˆçš„æ–‡ä»¶åŒ¹é…æ¨¡å¼ |
| `intelligentMarkdown.autoOpenPreviewOnlyWithLuaConfig` | boolean | `true` | ä»…å½“æ–‡ä»¶åŒ…å« lua-config å—æ—¶æ‰è‡ªåŠ¨é¢„è§ˆ |

### è‡ªåŠ¨é¢„è§ˆé…ç½®ç¤ºä¾‹

```json
{
  // å¯ç”¨è‡ªåŠ¨é¢„è§ˆ
  "intelligentMarkdown.autoOpenPreview": true,
  
  // åŒ¹é…æ‰€æœ‰ Markdown æ–‡ä»¶
  "intelligentMarkdown.autoOpenPreviewPattern": "**/*.md",
  
  // ä»…å½“åŒ…å« lua-config å—æ—¶æ‰è‡ªåŠ¨æ‰“å¼€
  "intelligentMarkdown.autoOpenPreviewOnlyWithLuaConfig": true
}
```

---

## å…­ã€å¼€å‘è·¯çº¿å›¾

### ç¬¬ä¸€é˜¶æ®µï¼šMVP åŸå‹ âœ…

| ä»»åŠ¡ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| é¡¹ç›®æ­å»º | âœ… | VS Code æ’ä»¶é¡¹ç›®ç»“æ„ |
| Lua è§£æå™¨ | âœ… | AST è§£æå’Œè·¯å¾„å®šä½ |
| é…ç½®å—è§£æ | âœ… | lua-config ä»£ç å—è§£æ |
| æ–‡æ¡£é“¾æ¥ | âœ… | ç‚¹å‡»è·³è½¬åˆ° Lua æºç  |
| æ‚¬åœæç¤º | âœ… | æ˜¾ç¤ºå˜é‡å½“å‰å€¼ |
| å†…è”å€¼æ˜¾ç¤º | âœ… | ç¼–è¾‘å™¨ä¸­æ˜¾ç¤ºå€¼ |

### ç¬¬äºŒé˜¶æ®µï¼šWebview ç¼–è¾‘å™¨ âœ…

| ä»»åŠ¡ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| Webview åŸºç¡€ | âœ… | é¢„è§ˆé¢æ¿æ¡†æ¶ |
| Markdown æ¸²æŸ“ | âœ… | æ–‡æ¡£å†…å®¹æ¸²æŸ“ |
| é…ç½®å—æ§ä»¶ | âœ… | 5 ç§æ§ä»¶ç±»å‹ |
| æ•°æ®å±•ç¤º | âœ… | æ˜¾ç¤º Lua å½“å‰å€¼ |

### ç¬¬ä¸‰é˜¶æ®µï¼šåŒå‘ç»‘å®š âœ…

| ä»»åŠ¡ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| å€¼å†™å…¥ | âœ… | ä¿®æ”¹ UI åå†™å…¥ Lua |
| æ–‡ä»¶ç›‘å¬ | âœ… | Lua å˜åŒ–æ—¶æ›´æ–° UI |
| è‡ªåŠ¨é¢„è§ˆ | âœ… | å¯é…ç½®è‡ªåŠ¨æ‰“å¼€é¢„è§ˆ |

### ç¬¬å››é˜¶æ®µï¼šé«˜çº§åŠŸèƒ½ ğŸ”„

| åŠŸèƒ½ | ä¼˜å…ˆçº§ | çŠ¶æ€ |
|------|--------|------|
| ç±»å‹æ ¡éªŒ | é«˜ | â¬œ |
| æ™ºèƒ½è¡¥å…¨ | ä¸­ | â¬œ |
| æ•°ç»„ç¼–è¾‘ | ä¸­ | â¬œ |
| Table é¢„è§ˆ | ä½ | â¬œ |
| é¢œè‰²é€‰æ‹©å™¨ | ä½ | â¬œ |
| æ‰¹é‡æ“ä½œ | ä½ | â¬œ |

---

## ä¸ƒã€æŠ€æœ¯æ ˆæ€»ç»“

| å±‚çº§ | æŠ€æœ¯é€‰å‹ | è¯´æ˜ |
|------|----------|------|
| **Extension** | TypeScript | VS Code æ’ä»¶å¼€å‘è¯­è¨€ |
| **AST è§£æ** | luaparse | Lua è¯­æ³•è§£æ |
| **æ„å»ºå·¥å…·** | Webpack 5 | æ‰“åŒ… Extension |
| **æµ‹è¯•** | Vitest | å•å…ƒæµ‹è¯•æ¡†æ¶ |
| **Webview** | åŸç”Ÿ HTML/CSS/JS | é¢„è§ˆç•Œé¢ |

---

## å…«ã€å…³é”®éš¾ç‚¹ä¸è§£å†³æ–¹æ¡ˆ

### éš¾ç‚¹ 1ï¼šå¤æ‚çš„ Lua Table åµŒå¥—å®šä½

**é—®é¢˜**ï¼šLua çš„ Table å¯ä»¥ä»»æ„åµŒå¥—ï¼Œå¦‚ä½•å‡†ç¡®å®šä½ï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**ï¼šé€’å½’éå† ASTï¼Œæ”¯æŒç‚¹å·åˆ†éš”çš„è·¯å¾„è¡¨è¾¾å¼ã€‚

### éš¾ç‚¹ 2ï¼šä¿æŒ Lua æ–‡ä»¶æ ¼å¼å’Œæ³¨é‡Š

**é—®é¢˜**ï¼šç›´æ¥é‡æ–°ç”Ÿæˆ Lua ä»£ç ä¼šä¸¢å¤±æ³¨é‡Šå’Œæ ¼å¼ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼šåªæ›¿æ¢å€¼çš„éƒ¨åˆ†ï¼Œä½¿ç”¨ range ç²¾å‡†å®šä½ã€‚

```typescript
// åªæ›¿æ¢å€¼ï¼Œä¿ç•™å‰åæ‰€æœ‰å†…å®¹
const newCode = code.slice(0, range[0]) + newValue + code.slice(range[1]);
```

### éš¾ç‚¹ 3ï¼šMarkdown ä¸­ HTML è¢«è½¬ä¹‰

**é—®é¢˜**ï¼šæ¸²æŸ“é…ç½®å—æ§ä»¶æ—¶ï¼ŒHTML è¢« Markdown è½¬æ¢å™¨è½¬ä¹‰ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼šä½¿ç”¨å ä½ç¬¦ç­–ç•¥ï¼š
1. å…ˆç”¨å ä½ç¬¦æ›¿æ¢é…ç½®å—
2. è¿›è¡Œ Markdown è½¬æ¢
3. æœ€åå°†å ä½ç¬¦æ›¿æ¢ä¸º HTML æ§ä»¶

---

## ä¹ã€ç¤ºä¾‹åœºæ™¯

### Webview æ¸²æŸ“æ•ˆæœ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  # ç©å®¶å±æ€§é…ç½®æ–‡æ¡£                                          â”‚
â”‚                                                             â”‚
â”‚  æœ¬æ–‡æ¡£ç”¨äºé…ç½®ç©å®¶çš„åŸºç¡€å±æ€§ï¼Œä¿®æ”¹åä¼šè‡ªåŠ¨åŒæ­¥åˆ° Lua ä»£ç ã€‚     â”‚
â”‚                                                             â”‚
â”‚  ## åŸºç¡€å±æ€§                                                â”‚
â”‚                                                             â”‚
â”‚  ### ç”Ÿå‘½å€¼                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚ ğŸ“ åŸºç¡€ç”Ÿå‘½å€¼                           â”‚               â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”             â”‚               â”‚
â”‚  â”‚ â”‚ âˆ’  â”‚ â”‚   1000   â”‚ â”‚ +  â”‚             â”‚               â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜             â”‚               â”‚
â”‚  â”‚ èŒƒå›´: 100 ~ 10000   æ­¥è¿›: 100           â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                                             â”‚
â”‚  ### ç§»åŠ¨é€Ÿåº¦                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚ ğŸ“ åŸºç¡€ç§»åŠ¨é€Ÿåº¦                         â”‚               â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 200 å•ä½/ç§’ â”‚               â”‚
â”‚  â”‚ 100                           500       â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                                             â”‚
â”‚  ### æ–°æ‰‹å¼•å¯¼                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚ ğŸ“ æ˜¾ç¤ºæ–°æ‰‹å¼•å¯¼                         â”‚               â”‚
â”‚  â”‚ ğŸŸ¢ ON                                   â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## åã€åç»­æ‰©å±•æ–¹å‘

1. **å¤šè¯­è¨€æ”¯æŒ**ï¼šæ‰©å±•åˆ° JSONã€YAMLã€TOML ç­‰é…ç½®æ ¼å¼
2. **å›¢é˜Ÿåä½œ**ï¼šé›†æˆ Git å˜æ›´è¿½è¸ª
3. **ç‰ˆæœ¬å¯¹æ¯”**ï¼šå¯è§†åŒ–å¯¹æ¯”ä¸åŒç‰ˆæœ¬çš„é…ç½®å·®å¼‚
4. **æ¨¡æ¿ç³»ç»Ÿ**ï¼šé¢„è®¾å¸¸ç”¨çš„é…ç½®æ¨¡æ¿
5. **æƒé™æ§åˆ¶**ï¼šæŸäº›å…³é”®é…ç½®è®¾ä¸ºåªè¯»
6. **å¯¼å‡ºåŠŸèƒ½**ï¼šå°† Markdown å¯¼å‡ºä¸º PDF/HTML æ–‡æ¡£

---

## åä¸€ã€å‚è€ƒèµ„æº

- [VS Code Extension API](https://code.visualstudio.com/api)
- [VS Code Webview API](https://code.visualstudio.com/api/extension-guides/webview)
- [luaparse - Lua Parser for JavaScript](https://github.com/fstirlitz/luaparse)
- [VS Code Custom Editor API](https://code.visualstudio.com/api/extension-guides/custom-editors)

---

*æ–‡æ¡£ç‰ˆæœ¬ï¼šv2.0*
*æœ€åæ›´æ–°ï¼š2026-02*
